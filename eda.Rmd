---
title: "EDA"
author: "Yuki Joyama"
date: "2024-03-20"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T, message = F, warning = F)

library(tidyverse)
library(ggplot2)
library(corrplot)

# setup plot theme
theme_set(
  theme_bw() +
    theme(legend.position = "top")
  )
```


```{r dataprep}
# read RData file
df_recov <- get(load("./data/recovery.RData")) |> 
  janitor::clean_names()

# check the response variable
# df_recov |> 
#   ggplot(aes(x = recovery_time)) +
#   geom_histogram(bins = 30, color = "black", fill = "gray")
```

# Histogram
```{r}
cate_recov = df_recov |>
  select(gender, race, smoking, hypertension, diabetes, vaccine, severity, study)
conti_recov = df_recov |>
  select(age, height, weight, bmi, sbp, ldl, recovery_time)

#ggplot(gather(conti_recov, cols, value), aes(x = value)) + 
#       geom_histogram(binwidth = 20) + facet_grid(.~cols)

#library(Hmisc)
#hist.data.frame(conti_recov)

par(mfrow = c(2, 4),  # Layout: 2 rows, 2 columns
    oma = c(2, 2, 3, 1),  # Outer margins
    mar = c(4, 4, 2, 1),  # Inner margins
    mgp = c(2, 1, 0))     # Margins for labels and title

hist(conti_recov$age, main = "Age", xlab = "Year", ylab = "Frequency")
hist(conti_recov$height, main = "Height", xlab = "cm", ylab = "Frequency")
hist(conti_recov$weight, main = "Weight", xlab = "kl", ylab = "Frequency")
hist(conti_recov$bmi, main = "BMI", xlab = " ", ylab = "Frequency")
hist(conti_recov$sbp, main = "SBP", xlab = "mm/Hg", ylab = "Frequency")
hist(conti_recov$ldl, main = "LDL", xlab = "mg/dL", ylab = "Frequency")
hist(conti_recov$recovery_time, main = "Recovery Time", xlab = "Day", ylab = "Frequency")
```

# Bar plot
```{r}
cate_recov = df_recov |>
  select(gender, race, smoking, hypertension, diabetes, vaccine, severity, study)
#ggplot(gather(cate_recov, cols, value), aes(x = value)) + 
#       geom_bar(binwidth = 20) + facet_grid(.~cols)

# Setting up the plotting area
par(mfrow = c(2, 4),  # Layout: 2 rows, 4 columns
    oma = c(2, 2, 3, 1),  # Outer margins
    mar = c(4, 4, 2, 1),  # Inner margins
    mgp = c(2, 1, 0))     # Margins for labels and title

barplot(table(cate_recov$gender), main = "Gender", ylab = "Count")
barplot(table(cate_recov$race), main = "Race", ylab = "Count")
barplot(table(cate_recov$smoking), main = "Smoking", ylab = "Count")
barplot(table(cate_recov$hypertension), main = "Hypertension", ylab = "Count")
barplot(table(cate_recov$diabetes), main = "Diabetes", ylab = "Count")
barplot(table(cate_recov$vaccine), main = "Vaccine", ylab = "Count")
barplot(table(cate_recov$severity), main = "Severity", ylab = "Count")
barplot(table(cate_recov$study), main = "Study", ylab = "Count")


```

# Correlation
```{r}
numeric_df_recov <- df_recov |>
  mutate(race = as.numeric(race)) |>
  mutate(smoking = as.numeric(smoking)) |>
  mutate(study = as.numeric(as.factor(study))) |>
  select_if(is.numeric)


# Compute the correlation matrix
correlation_matrix <- cor(numeric_df_recov)

# Plot the correlation matrix
corrplot(correlation_matrix, method = "circle", type = "upper", order = "hclust")

```

# Table 1
```{r}

```

